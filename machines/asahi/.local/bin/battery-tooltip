#!/bin/bash
# Battery tooltip with health, cycles, and temperature

BATTERY_PATH="/sys/class/power_supply/macsmc-battery"

# Calculate health percentage from charge_full vs charge_full_design
charge_full=$(cat "$BATTERY_PATH/charge_full" 2>/dev/null || echo "0")
charge_design=$(cat "$BATTERY_PATH/charge_full_design" 2>/dev/null || echo "0")

if [ "$charge_design" -gt 0 ]; then
    health=$(awk "BEGIN {printf \"%.0f\", ($charge_full / $charge_design) * 100}")
else
    health="?"
fi

# Get cycle count
cycles=$(cat "$BATTERY_PATH/cycle_count" 2>/dev/null || echo "?")

# Get temperature (in 0.1°C units, convert to °C)
temp_raw=$(cat "$BATTERY_PATH/temp" 2>/dev/null || echo "0")
temp=$(awk "BEGIN {printf \"%.1f\", $temp_raw/10}")

# Format tooltip
echo "Health: ${health}%
Cycles: ${cycles}
Temp: ${temp}°C"
