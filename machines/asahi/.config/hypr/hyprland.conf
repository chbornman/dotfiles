# Hyprland config - Capstan Cloud theme
# Ported from Sway config for Asahi Linux

# ============================================================================
# MONITOR
# ============================================================================

monitor = , preferred, auto, auto

# ============================================================================
# INPUT
# ============================================================================

input {
    kb_layout = us
    kb_options = ctrl:nocaps

    repeat_rate = 40
    repeat_delay = 600

    follow_mouse = 1

    touchpad {
        natural_scroll = true
        tap-to-click = true
        scroll_factor = 0.25
        clickfinger_behavior = true
    }

    sensitivity = 0.25
}

# ============================================================================
# APPEARANCE - Capstan Cloud Theme
# ============================================================================

general {
    gaps_in = 3
    gaps_out = 6
    border_size = 1

    col.active_border = rgb(d4a366)
    col.inactive_border = rgb(393634)

    layout = dwindle
}

decoration {
    rounding = 8

    blur {
        enabled = false
    }

    shadow {
        enabled = false
    }
}

animations {
    enabled = true

    bezier = snappy, 0.25, 0.1, 0.25, 1.04

    animation = windows, 1, 3, snappy, slide
    animation = windowsOut, 1, 5, snappy, slide
    animation = windowsMove, 1, 3, snappy, slide
    animation = fade, 1, 3, snappy
    animation = workspaces, 1, 3, snappy, slide
    animation = border, 1, 5, default
}

dwindle {
    pseudotile = false
    preserve_split = true
    force_split = 2
}

misc {
    disable_hyprland_logo = true
    disable_splash_rendering = true
    force_default_wallpaper = 0
}

# ============================================================================
# WINDOW RULES
# ============================================================================

# Wofi floating
windowrulev2 = float, class:^(wofi)$
windowrulev2 = bordersize 2, class:^(wofi)$

# Waybar floating menus (terminal menus launched from waybar)
windowrulev2 = float, title:^(WAYBAR-MENU:.*)$
windowrulev2 = pin, title:^(WAYBAR-MENU:.*)$
windowrulev2 = move 100%-606 38, title:^(WAYBAR-MENU:.*)$
# Default size for most menus
windowrulev2 = size 600 450, title:^(WAYBAR-MENU: audio)$
windowrulev2 = size 600 450, title:^(WAYBAR-MENU: bluetooth)$
windowrulev2 = size 600 450, title:^(WAYBAR-MENU: network)$
windowrulev2 = size 600 450, title:^(WAYBAR-MENU: battery)$
windowrulev2 = size 600 450, title:^(WAYBAR-MENU: calendar)$
windowrulev2 = size 600 450, title:^(WAYBAR-MENU: mail)$
# CPU/btop needs more space
windowrulev2 = size 900 650, title:^(WAYBAR-MENU: cpu)$
windowrulev2 = move 100%-906 38, title:^(WAYBAR-MENU: cpu)$
# Mail menu - top left
windowrulev2 = move 6 38, title:^(WAYBAR-MENU: mail)$

# PavuControl - floating, top right (like other waybar menus)
windowrulev2 = float, class:^(org.pulseaudio.pavucontrol)$
windowrulev2 = size 600 450, class:^(org.pulseaudio.pavucontrol)$
windowrulev2 = move 100%-606 38, class:^(org.pulseaudio.pavucontrol)$

# LocalSend - floating, top left area (near waybar)
windowrulev2 = float, class:^(localsend)$
windowrulev2 = size 400 500, class:^(localsend)$
windowrulev2 = move 120 38, class:^(localsend)$

# Picture-in-Picture - float, stay on top, bottom-right
windowrulev2 = float, title:^(Picture-in-Picture)$
windowrulev2 = pin, title:^(Picture-in-Picture)$
windowrulev2 = move 100%-619 100%-352, title:^(Picture-in-Picture)$

windowrulev2 = float, title:^(Picture in Picture)$
windowrulev2 = pin, title:^(Picture in Picture)$
windowrulev2 = move 100%-619 100%-352, title:^(Picture in Picture)$

windowrulev2 = float, class:^(zen)$, title:(?i)picture
windowrulev2 = pin, class:^(zen)$, title:(?i)picture
windowrulev2 = move 100%-619 100%-352, class:^(zen)$, title:(?i)picture

windowrulev2 = float, class:^(app.zen_browser.zen)$, title:(?i)picture
windowrulev2 = pin, class:^(app.zen_browser.zen)$, title:(?i)picture
windowrulev2 = move 100%-619 100%-352, class:^(app.zen_browser.zen)$, title:(?i)picture

# Ghostty transparency
windowrulev2 = opacity 0.9 0.85, class:^(com.mitchellh.ghostty)$

# Dim overlay
windowrulev2 = float, title:^WAYBAR-DIM-OVERLAY$
windowrulev2 = move 0 0, title:^WAYBAR-DIM-OVERLAY$
windowrulev2 = noborder, title:^WAYBAR-DIM-OVERLAY$
windowrulev2 = nofocus, title:^WAYBAR-DIM-OVERLAY$

# ============================================================================
# KEYBINDINGS
# ============================================================================

$mod = SUPER

# Applications
bind = $mod, Return, exec, ghostty
bind = $mod, space, exec, wofi --show drun
bind = $mod, b, exec, flatpak run app.zen_browser.zen
bind = $mod SHIFT, b, exec, ghostty -e bluetui
bind = $mod, c, exec, flatpak run app.zen_browser.zen --new-window https://calendar.google.com
bind = $mod, g, exec, flatpak run app.zen_browser.zen --new-window https://mail.google.com
bind = $mod, o, exec, ~/.local/bin/obsidian
bind = $mod, f, exec, ghostty -e yazi
bind = $mod SHIFT, f, exec, nautilus
bind = $mod SHIFT, s, exec, flatpak run org.localsend.localsend_app
bind = $mod, a, exec, ghostty -e /home/caleb/.local/bin/opencode
bind = $mod, m, exec, ghostty -e ~/.cargo/bin/mailtui
bind = $mod, t, exec, flatpak run org.telegram.desktop -- tg://resolve?domain=claudiusclaudius_bot
bind = $mod, y, exec, flatpak run app.zen_browser.zen --new-window https://youtube.com
bind = $mod, n, exec, nextcloud

# Whisper dictation
bind = $mod, d, exec, ~/projects/asahi-whisper-daemon/toggle_dictation.sh
bind = $mod SHIFT, d, exec, ~/projects/asahi-whisper-daemon/toggle_stream.sh

# Screenshots
bind = $mod, p, exec, ~/.local/bin/screenshot area
bind = $mod SHIFT, p, exec, ~/.local/bin/screenshot screen
bind = $mod ALT, p, exec, ~/.local/bin/screenshot window

# Screen recording
bind = $mod, r, exec, ~/.local/bin/screenrecord area
bind = $mod SHIFT, r, exec, ~/.local/bin/screenrecord screen
bind = $mod ALT, r, exec, ~/.local/bin/screenrecord window

# Clipboard paste (for terminals that don't support Ctrl+Shift+v)
bind = $mod, v, exec, sleep 0.5 && wtype "$(wl-paste)"

# Forward delete (SUPER + Backspace)
bind = $mod, backspace, sendshortcut, , Delete, activewindow

# Window management
bind = $mod, q, killactive
bind = $mod SHIFT, space, togglefloating
bind = $mod, F11, fullscreen
bind = CTRL, Return, fullscreen

# Focus (vim-style)
bind = $mod, h, movefocus, l
bind = $mod, j, movefocus, d
bind = $mod, k, movefocus, u
bind = $mod, l, movefocus, r

# Focus (arrow keys)
bind = $mod, left, movefocus, l
bind = $mod, down, movefocus, d
bind = $mod, up, movefocus, u
bind = $mod, right, movefocus, r

# Move windows (vim-style)
bind = $mod SHIFT, h, movewindow, l
bind = $mod SHIFT, j, movewindow, d
bind = $mod SHIFT, k, movewindow, u
bind = $mod SHIFT, l, movewindow, r

# Move windows (arrow keys)
bind = $mod SHIFT, left, movewindow, l
bind = $mod SHIFT, down, movewindow, d
bind = $mod SHIFT, up, movewindow, u
bind = $mod SHIFT, right, movewindow, r

# Toggle split orientation (flip horizontal/vertical)
bind = $mod, backslash, layoutmsg, togglesplit

# Workspaces
bind = $mod, 1, workspace, 1
bind = $mod, 2, workspace, 2
bind = $mod, 3, workspace, 3
bind = $mod, 4, workspace, 4
bind = $mod, 5, workspace, 5
bind = $mod, 6, workspace, 6
bind = $mod, 7, workspace, 7
bind = $mod, 8, workspace, 8
bind = $mod, 9, workspace, 9
bind = $mod, 0, workspace, 10

# Move to workspace
bind = $mod SHIFT, 1, movetoworkspace, 1
bind = $mod SHIFT, 2, movetoworkspace, 2
bind = $mod SHIFT, 3, movetoworkspace, 3
bind = $mod SHIFT, 4, movetoworkspace, 4
bind = $mod SHIFT, 5, movetoworkspace, 5
bind = $mod SHIFT, 6, movetoworkspace, 6
bind = $mod SHIFT, 7, movetoworkspace, 7
bind = $mod SHIFT, 8, movetoworkspace, 8
bind = $mod SHIFT, 9, movetoworkspace, 9
bind = $mod SHIFT, 0, movetoworkspace, 10

# Move workspace to other monitor
bind = $mod SHIFT, m, movecurrentworkspacetomonitor, +1


# Direct resize bindings (without entering resize mode)
# SUPER +/- for horizontal resize
binde = $mod, minus, resizeactive, -50 0
binde = $mod, equal, resizeactive, 50 0
# SUPER SHIFT +/- for vertical resize
binde = $mod SHIFT, minus, resizeactive, 0 -50
binde = $mod SHIFT, equal, resizeactive, 0 50

# Toggle waybar visibility
bind = $mod, i, exec, killall -SIGUSR1 waybar

# System
bind = $mod, Escape, exec, hyprlock
bind = $mod SHIFT, c, exec, hyprctl reload
bind = $mod SHIFT, e, exit

# Media keys
bindel = , XF86AudioRaiseVolume, exec, ~/.local/bin/vol up
bindel = , XF86AudioLowerVolume, exec, ~/.local/bin/vol down
bindl = , XF86AudioMute, exec, ~/.local/bin/vol mute
bindl = , XF86AudioMicMute, exec, pactl set-source-mute @DEFAULT_SOURCE@ toggle

# Brightness keys
bindel = , XF86MonBrightnessUp, exec, ~/.local/bin/bright up
bindel = , XF86MonBrightnessDown, exec, ~/.local/bin/bright down

# Keyboard backlight
bindel = SHIFT, XF86MonBrightnessUp, exec, ~/.local/bin/kbright up
bindel = SHIFT, XF86MonBrightnessDown, exec, ~/.local/bin/kbright down
bindel = , XF86KbdBrightnessUp, exec, ~/.local/bin/kbright up
bindel = , XF86KbdBrightnessDown, exec, ~/.local/bin/kbright down

# F3/F4 file manager shortcuts
bind = , XF86LaunchA, exec, ghostty -e yazi
bind = , XF86Search, exec, nautilus

# Mouse bindings
bindm = $mod, mouse:272, movewindow
bindm = $mod, mouse:273, resizewindow

# Touchpad gestures
bind = , swipe:3:l, workspace, +1
bind = , swipe:3:r, workspace, -1

# ============================================================================
# ENVIRONMENT
# ============================================================================

env = GTK_THEME,Adwaita:dark
env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_TYPE,wayland
env = XDG_SESSION_DESKTOP,Hyprland

# ============================================================================
# AUTOSTART
# ============================================================================

exec-once = hyprlock
exec-once = ~/.local/bin/waybar-hovermenu
exec-once = sh -c 'while [ ! -S /tmp/waybar-hovermenu.sock ]; do sleep 0.1; done; waybar'
exec-once = mako
exec-once = hypridle
exec-once = swaybg -i ~/Pictures/background.jpg -m fill

# Fix ydotool socket permissions for waybar menu mouse jiggle
exec-once = sh -c 'for i in 1 2 3 4 5; do [ -S /tmp/.ydotool_socket ] && sudo chmod 666 /tmp/.ydotool_socket && break; sleep 1; done'
