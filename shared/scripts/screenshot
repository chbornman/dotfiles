#!/bin/bash
# Screenshot script with clickable notification to open in yazi

SCREENSHOTS_DIR="$HOME/Downloads"
FILENAME="screenshot-$(date +%Y%m%d-%H%M%S).png"
FILEPATH="$SCREENSHOTS_DIR/$FILENAME"

# Determine mode from argument
MODE="${1:-area}"

case "$MODE" in
    area|anything)
        grim -g "$(slurp)" "$FILEPATH"
        ;;
    screen)
        grim "$FILEPATH"
        ;;
    window)
        grim -g "$(hyprctl activewindow -j | jq -r '"\(.at[0]),\(.at[1]) \(.size[0])x\(.size[1])"')" "$FILEPATH"
        ;;
    *)
        echo "Usage: screenshot [area|screen|window]"
        exit 1
        ;;
esac

# Check if screenshot was taken
if [ ! -f "$FILEPATH" ]; then
    exit 1
fi

# Copy to clipboard
wl-copy < "$FILEPATH"

# Save filepath for mako click handler
echo "$FILEPATH" > /tmp/last-screenshot

# Send notification (clicking it opens file manager via mako config)
notify-send -a "screenshot" \
    -i "$FILEPATH" \
    "Screenshot saved" \
    "$FILENAME (click to open)"
