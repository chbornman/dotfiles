#!/bin/bash
# Window switcher that cycles through windows in MRU order

# Get the currently focused window address
current_addr=$(hyprctl activewindow -j | jq -r '.address // empty')

# Get all windows
windows=$(hyprctl clients -j | jq -r '
  .[] | 
  select(.class != null or .initialClass != null) |
  select(.title != null) |
  select(.pid != null) |
  "\(.address)|\(.title)|\(.class // .initialClass)|\(.workspace.name // "unknown")"
')

if [ -z "$windows" ]; then
    notify-send "Window Switcher" "No windows found" -u low
    exit 0
fi

# Build array of window addresses
readarray -t window_array <<< "$windows"

# Find current window index
current_index=-1
for i in "${!window_array[@]}"; do
    win_addr=$(echo "${window_array[$i]}" | cut -d'|' -f1)
    if [ "$win_addr" = "$current_addr" ]; then
        current_index=$i
        break
    fi
done

# Get next window (cycle to beginning if at end)
if [ $current_index -eq -1 ]; then
    # No current window, focus first
    next_index=0
else
    next_index=$(( (current_index + 1) % ${#window_array[@]} ))
fi

# Get next window info
next_window="${window_array[$next_index]}"
next_addr=$(echo "$next_window" | cut -d'|' -f1)
next_name=$(echo "$next_window" | cut -d'|' -f2)

# Focus the next window
hyprctl dispatch focuswindow "address:$next_addr"

# Show notification with window name
notify-send -t 1000 "Switched to" "$next_name" -u low
