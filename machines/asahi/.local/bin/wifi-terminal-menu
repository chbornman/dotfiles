#!/bin/bash
# Launch impala (wifi manager) as a floating terminal window

{
    LOCK_FILE="/tmp/wofi-menu.lock"
    MENU_NAME="wifi"

    # Check if this menu is already open by looking for the window
    if pgrep -f "WAYBAR-MENU: impala" > /dev/null; then
        pkill -f "WAYBAR-MENU: impala"
        rm -f "$LOCK_FILE"
        sleep 0.15
        YDOTOOL_SOCKET=/tmp/.ydotool_socket ydotool mousemove -x 1 -y 0
        YDOTOOL_SOCKET=/tmp/.ydotool_socket ydotool mousemove -x -1 -y 0
        exit 0
    fi

    # Close any other menu that might be open
    pkill -f "WAYBAR-MENU:" 2>/dev/null
    pkill -x wofi 2>/dev/null
    rm -f "$LOCK_FILE"

    # Mark this menu as open and launch
    echo "$MENU_NAME" > "$LOCK_FILE"
    foot --title='WAYBAR-MENU: impala' impala &
    sleep 0.15
    YDOTOOL_SOCKET=/tmp/.ydotool_socket ydotool mousemove -x 1 -y 0
    YDOTOOL_SOCKET=/tmp/.ydotool_socket ydotool mousemove -x -1 -y 0
    wait
    rm -f "$LOCK_FILE"
} &

disown
exit 0
