#!/bin/bash
# Creates a semi-transparent overlay to dim the screen

LOCK_FILE="/tmp/dim-overlay.lock"

case "$1" in
    show)
        # Don't create multiple overlays
        [ -f "$LOCK_FILE" ] && exit 0
        
        touch "$LOCK_FILE"
        
        # Get monitor dimensions
        hyprctl monitors -j | jq -r '.[0] | "\(.width)x\(.height)"' | while read size; do
            width=$(echo $size | cut -dx -f1)
            height=$(echo $size | cut -dx -f2)
            
            # Launch ghostty fullscreen with semi-transparent black background
            ghostty --title=WAYBAR-DIM-OVERLAY --window-width=$width --window-height=$height --background=000000 --background-opacity=0.6 -e cat &
        done
        
        # Wait for window - hyprland windowrules should handle floating/position
        sleep 0.15
        ;;
    hide)
        hyprctl dispatch closewindow "title:WAYBAR-DIM-OVERLAY" > /dev/null 2>&1
        rm -f "$LOCK_FILE"
        ;;
esac
